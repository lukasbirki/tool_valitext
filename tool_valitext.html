<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lukas Birkenmaier">

<title>ValiText - A Validation Framework for Text-Based Measures of Social Constructs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="tool_valitext_files/libs/clipboard/clipboard.min.js"></script>
<script src="tool_valitext_files/libs/quarto-html/quarto.js"></script>
<script src="tool_valitext_files/libs/quarto-html/popper.min.js"></script>
<script src="tool_valitext_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="tool_valitext_files/libs/quarto-html/anchor.min.js"></script>
<link href="tool_valitext_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tool_valitext_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="tool_valitext_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="tool_valitext_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="tool_valitext_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ValiText - A Validation Framework for Text-Based Measures of Social Constructs</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lukas Birkenmaier </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1. Introduction</h1>
<p>In this tutorial, we introduce the <a href="https://www.valitex.info/">ValiText</a> tool, a framework and instrument for validating text-based measures of social constructs. ValiText helps researchers to execute and document validation by providing conceptual and practical guidance for researchers <span class="citation" data-cites="birkenmaier2023valitext">(<a href="#ref-birkenmaier2023valitext" role="doc-biblioref">Birkenmaier, Wagner, and Lechner 2023</a>)</span>.</p>
<p>Validation is a necessary requirement for any text analysis <span class="citation" data-cites="grimmer2013text">(<a href="#ref-grimmer2013text" role="doc-biblioref">Grimmer and Stewart 2013</a>)</span>. Essentially, the purpose of validation is to ensure that what is to be measured (i.e., the numerical scores assigned to texts) correspond to the true<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> nature of the construct being studied.</p>
<p>Data Quality is an important requirement for validity. Low quality data can significantly affect the validity of text-based measures. For instance, when the text data is incomplete, ambiguous, or misrepresentative, it becomes challenging to draw accurate inferences about social science phenomena. However, detecting these data quality issues can be difficult. ValiText helps researchers with a shared vocabulary denoting different validation steps, as well as practical checklists that can be downloaded and filled-out to document validation.</p>
<p>At its core, the ValiText tool can be used for any of the following tasks:</p>
<ol type="1">
<li>Defining the key types of validation evidence that are required for sufficient validation</li>
<li>Guide researchers which concrete validation steps to apply for their text-based research, and</li>
<li>Provide a documentation template in the form of a checklist that can be used to document validation efforts effectively.</li>
</ol>
<p>In this tutorial, we will begin by presenting the framework (Chapter 2), followed by a practical example of its use in measuring sexism in social media posts (Chapter 3), and finally conclude with a discussion (Chapter 4).</p>
</section>
<section id="valitext-tool" class="level1">
<h1>2. ValiText Tool</h1>
<p>Validation is a critical task in text analysis and natural language processing. At its core, validation involves various activities to demonstrate that a method measures what it purports to measure <span class="citation" data-cites="cureton1951validity repke2024validity">(<a href="#ref-cureton1951validity" role="doc-biblioref">Cureton 1951</a>; <a href="#ref-repke2024validity" role="doc-biblioref">Repke, Birkenmaier, and Lechner 2024</a>)</span>. However, validating text-based measures can be challenging <span class="citation" data-cites="krippendorff2009content">(<a href="#ref-krippendorff2009content" role="doc-biblioref">Krippendorff 2009</a>)</span>.</p>
<p>Therefore, any empirical measure needs to be validated. One crucial problem in the validation of text-based measures, however, is the lack of conceptual clarity on how to conduct validation.</p>
<p>To provide practical guidance for researchers and users to conduct and communicate validation, ValiText offers a flexible and consistent approach to validation.</p>
<p>At its core, ValiText requires three types of validation evidence:</p>
<ul>
<li><strong>Substantive Evidence</strong>: Requires outlining the <strong>theoretical underpinning</strong> of the measure.</li>
<li><strong>Structural Evidence</strong>: Requires examining and evaluating <strong>properties of the model and its measures</strong>.</li>
<li><strong>External Evidence</strong>: Requires testing how the measure relates to <strong>other independent information or criteria</strong>.</li>
</ul>
<p>The framework is complemented by a checklist that defines and outlines empirical validation steps available to collect validity evidence for different use cases.</p>
<p>If you want to learn more about the framework and the checklist, please click on the respective section below or have a look at the corresponding <a href="https://arxiv.org/abs/2307.02863">paper</a>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Framework</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Checklist</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/framework.png" class="img-fluid figure-img"></p>
<figcaption>Conceptual Framework</figcaption>
</figure>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Different checklists are available for different use cases, depending on the text-based methods used. The table below summarises the use cases, and provides download links to the checklists</p>
<div style="font-size: 0.85em;">
<table class="caption-top table">
<thead>
<tr class="header">
<th>#</th>
<th>Use Case</th>
<th>Training Data Required</th>
<th>Known Output Categories</th>
<th>Description</th>
<th>Example</th>
<th>Checklist Download</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>Dictionaries</td>
<td>No</td>
<td>Yes</td>
<td>Assign scores to text units using predefined word lists</td>
<td>A dictionary assigns polarity values ranging from -1 to 1 to each known text unit</td>
<td><a href="https://github.com/lukasbirki/golemvalitext/raw/main/data-raw/checklists/checklist_A_ValiTex.docx" class="btn"><img src="https://cdn-icons-png.flaticon.com/512/2739/2739765.png" class="img-fluid" width="30" alt="Download A"></a></td>
</tr>
<tr class="even">
<td>B</td>
<td>(Semi-) Supervised Classification</td>
<td>Yes</td>
<td>Yes</td>
<td>Train a model to predict known output categories based on labelled data</td>
<td>A pretrained BERT model is fine-tuned on labelled social media posts and predicts “offensive” and “non-offensive” posts</td>
<td><a href="https://github.com/lukasbirki/golemvalitext/raw/main/data-raw/checklists/checklist_B_ValiTex.docx" class="btn"><img src="https://cdn-icons-png.flaticon.com/512/2739/2739765.png" class="img-fluid" width="30" alt="Download B"></a></td>
</tr>
<tr class="odd">
<td>C</td>
<td>Prompt-based Classification Using LLMs</td>
<td>Yes</td>
<td>Yes</td>
<td>Ask (“prompt”) LLMs to assign labels to texts</td>
<td>A Mistral model is prompted to determine whether a text is “sexist” or “non-sexist”</td>
<td><a href="https://github.com/lukasbirki/golemvalitext/raw/main/data-raw/checklists/checklist_C_ValiTex.docx" class="btn"><img src="https://cdn-icons-png.flaticon.com/512/2739/2739765.png" class="img-fluid" width="30" alt="Download C"></a></td>
</tr>
<tr class="even">
<td>D</td>
<td>Topic Modelling</td>
<td>No</td>
<td>No</td>
<td>Assign topics without any labeled data</td>
<td>An LDA topic model generates 13 coherent topics</td>
<td><a href="https://github.com/lukasbirki/golemvalitext/raw/main/data-raw/checklists/checklist_D_ValiTex.docx" class="btn"><img src="https://cdn-icons-png.flaticon.com/512/2739/2739765.png" class="img-fluid" width="30" alt="Download D"></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section>
<section id="application-and-use-case" class="level1">
<h1>3. Application and use case</h1>
<p>We demonstrate the applicability of the tool by revisiting and documenting the validation steps from a study by <span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span>. In their study, <span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> rely on different types of supervised machine learning models to detect sexist social media posts within different social media datasets.</p>
<p>Detecting sexism is a challenging task due to its complex nature, as sexist language often manifests in subtle and nuanced ways. In their paper, <span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> investigate several strategies to enhance the measurement of such data. Since their study utilizes a labeled dataset (i.e., data with human-provided annotations), the focus shifts from exploring research questions to improving the model’s ability to classify texts.</p>
<p>Since their study utilizes supervised models, we completed the checklist “B: (Semi-) Supervised Classification”. We illustrate how the checklist can act as a documentation tool, providing a clearly structured overview over all relevant validation steps. Naturally, for other use cases, the tool can also guide validation conceptually, and assist in interpreting the metrics identified during validation.</p>
<p>Below, we provide the filled-out checklists for each overarching type of validation evidence. In each chapter, we highlight single validation steps and how ValiText can help to document and evaluate them. The full discussion of all validation steps can be found in the corresponding <a href="https://arxiv.org/abs/2307.02863">paper</a>.</p>
<section id="substantive-evidence" class="level2">
<h2 class="anchored" data-anchor-id="substantive-evidence">Substantive Evidence</h2>
<p><span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> engage with the literature on sexism and computational methods, highlighting definitional ambiguities and potential biases. They justify their operationalization by developing a codebook based on subdimensions of sexism and annotating training data for machine-learning models, using supervised methods like Logit, CNN, and BERT to compare performance. The authors also discuss data collection decisions, use of adversarial examples, and select the sentence level for analysis, while providing preprocessing details primarily for the Logit model.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Filled-Out Checklist
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<iframe src="images/substantive.pdf" width="100%" height="600px">
</iframe>
</div>
</div>
</div>
<hr>
</section>
<section id="structural-evidence" class="level2">
<h2 class="anchored" data-anchor-id="structural-evidence">Structural Evidence</h2>
<p><span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> provide structural evidence by evaluating both model properties and output. They inspect predictive model features (II.1), comparing the most predictive unigrams across datasets and methods, noting that models trained on adversarial examples demonstrate greater robustness. For model output evaluation, they conduct error analysis (II.5) on misclassified examples using their BERT model, examining factors like model type, data origin, and coder agreement to identify systematic errors.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Filled-Out Checklist
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<iframe src="images/structural.pdf" width="100%" height="600px">
</iframe>
</div>
</div>
</div>
<hr>
</section>
<section id="external-evidence" class="level2">
<h2 class="anchored" data-anchor-id="external-evidence">External Evidence</h2>
<p>To demonstrate external evidence, <span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> primarily rely on the comparison of measures with a human-annotated test set (III.1). To calculate classification performance, they apply k-fold cross-validation and report F1 scores. The evaluation of F1 score is widely regarded as the most viable metric, as alternative metrics such as accuracy (i.e., the overall ratio of positive predictions) can be misleading when dealing with imbalanced data <span class="citation" data-cites="spelmen2018review">(<a href="#ref-spelmen2018review" role="doc-biblioref">Spelmen and Porkodi 2018</a>)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Filled-Out Checklist
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<iframe src="images/external.pdf" width="100%" height="600px">
</iframe>
</div>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>4. Discussion</h1>
<!-- Roughly summarised by ChatGPT -->
<p>In summary, ValiText offers a structured and systematic framework for validating text-based measures of social constructs, such as sexism in online content. One of its major advantages is the clarity it brings to the validation process, enabling researchers to document and communicate their efforts effectively. By providing pre-structured checklists, ValiText reduces the cognitive load on researchers and promotes transparency, offering a uniform way to ensure that all critical aspects of validation—substantive, structural, and external—are addressed.</p>
<p>However, despite its strengths, the framework may have some limitations. For example, the reliance on self-assessment tools like ValiText might introduce subjectivity into the process, as researchers could be inclined to interpret the validation steps in a way that supports their results. Furthermore, the tool assumes a baseline level of understanding of validation practices, which could be a barrier for researchers new to the field of computational text analysis.</p>
<p>In practice, the use of ValiText in studies like that of <span class="citation" data-cites="samory2021call">Samory et al. (<a href="#ref-samory2021call" role="doc-biblioref">2021</a>)</span> demonstrates the value of having a clear, consistent approach to validating computational methods. However, the dynamic nature of social constructs like sexism poses a unique challenge. Constructs often evolve over time and across contexts, which raises questions about the generalization of validation practices across different studies and datasets.</p>

</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-birkenmaier2023valitext" class="csl-entry" role="listitem">
Birkenmaier, Lukas, Claudia Wagner, and Clemens Lechner. 2023. <span>“ValiText – a Unified Validation Framework for Computational Text-Based Measures of Social Constructs.”</span> <a href="https://arxiv.org/abs/2307.02863">https://arxiv.org/abs/2307.02863</a>.
</div>
<div id="ref-cureton1951validity" class="csl-entry" role="listitem">
Cureton, Edward E. 1951. <span>“Validity.”</span>
</div>
<div id="ref-grimmer2013text" class="csl-entry" role="listitem">
Grimmer, Justin, and Brandon M Stewart. 2013. <span>“Text as Data: The Promise and Pitfalls of Automatic Content Analysis Methods for Political Texts.”</span> <em>Political Analysis</em> 21 (3): 267–97.
</div>
<div id="ref-krippendorff2009content" class="csl-entry" role="listitem">
Krippendorff, Klaus. 2009. <em>The Content Analysis Reader</em>. Sage.
</div>
<div id="ref-repke2024validity" class="csl-entry" role="listitem">
Repke, Lydia, Lukas Birkenmaier, and Clemens Lechner. 2024. <span>“Validity in Survey Research-from Research Design to Measurement Instruments.”</span> <em>GESIS Survey Guides</em>.
</div>
<div id="ref-samory2021call" class="csl-entry" role="listitem">
Samory, Mattia, Indira Sen, Julian Kohne, Fabian Flöck, and Claudia Wagner. 2021. <span>“<span>‘Call Me Sexist, but...’</span>: Revisiting Sexism Detection Using Psychological Scales and Adversarial Samples.”</span> In <em>Proceedings of the International AAAI Conference on Web and Social Media</em>, 15:573–84.
</div>
<div id="ref-spelmen2018review" class="csl-entry" role="listitem">
Spelmen, Vimalraj S, and R Porkodi. 2018. <span>“A Review on Handling Imbalanced Data.”</span> In <em>2018 International Conference on Current Trends Towards Converging Technologies (ICCTCT)</em>, 1–11. IEEE.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Nevertheless, it’s important to acknowledge that the “true” nature of a text is inherently unobservable and can only be approximated. For instance, while we might interpret a certain text as positive or negative, these characteristics are not intrinsic to the text itself; they are inferred and open to subjective interpretation <span class="citation" data-cites="krippendorff2009content">(<a href="#ref-krippendorff2009content" role="doc-biblioref">Krippendorff 2009</a>)</span><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>